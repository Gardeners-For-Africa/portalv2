echo "🔍 Running lint-staged (Biome on staged files)..."
yarn lint-staged || exit 1

CHANGED="$(git diff --name-only --cached)"

if echo "$CHANGED" | grep -q '^api/'; then
  echo "🧪 api changed → typecheck + tests"
  yarn workspace api typecheck || exit 1
  yarn workspace api test || exit 1
fi

if echo "$CHANGED" | grep -q '^web/'; then
  echo "🧪 web changed → typecheck + tests"
  yarn workspace web typecheck || exit 1
  yarn workspace web test || exit 1
fi